<Window x:Class="rattrapageB4.Views.AppointmentWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Gestion des Rendez-vous" Height="420" Width="860"
        WindowStartupLocation="CenterOwner">

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <!-- Tableau prioritaire -->
            <ColumnDefinition Width="3*"/>
            <!-- Formulaire plus petit -->
            <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>

        <!-- Table des RDV -->
        <DataGrid x:Name="AppointmentGrid"
                  Grid.Column="0"
                  AutoGenerateColumns="False"
                  SelectionMode="Single"
                  SelectionChanged="AppointmentGrid_SelectionChanged">

            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50" IsReadOnly="True"/>

                <DataGridTextColumn Header="Début"
                                    Binding="{Binding StartAt, StringFormat=dd/MM/yyyy HH:mm}"
                                    Width="150" IsReadOnly="True"/>

                <DataGridTextColumn Header="Fin"
                                    Binding="{Binding EndAt, StringFormat=dd/MM/yyyy HH:mm}"
                                    Width="150" IsReadOnly="True"/>

                <!-- Médecin : liste déroulante (pas de texte libre) -->
                <DataGridComboBoxColumn Header="Médecin"
                                        ItemsSource="{Binding ItemsSource, Source={x:Reference DoctorCombo}}"
                                        DisplayMemberPath="FullName"
                                        SelectedValuePath="Id"
                                        SelectedValueBinding="{Binding DoctorId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        Width="*"/>

                <!-- Patient : liste déroulante (pas de texte libre) -->
                <DataGridComboBoxColumn Header="Patient"
                                        ItemsSource="{Binding ItemsSource, Source={x:Reference PatientCombo}}"
                                        DisplayMemberPath="FullName"
                                        SelectedValuePath="Id"
                                        SelectedValueBinding="{Binding PatientId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        Width="*"/>

                <DataGridTextColumn Header="Notes" Binding="{Binding Notes}" Width="*" IsReadOnly="True"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Formulaire (scrollable + compact) -->
        <ScrollViewer Grid.Column="1"
                      MaxWidth="360"
                      VerticalAlignment="Stretch"
                      HorizontalScrollBarVisibility="Disabled"
                      VerticalScrollBarVisibility="Auto"
                      Margin="20,0,0,0">

            <StackPanel>
                <Label Content="Médecin"/>
                <ComboBox x:Name="DoctorCombo"
                          DisplayMemberPath="FullName"
                          SelectedValuePath="Id"
                          Height="26"/>

                <Label Content="Patient" Margin="0,8,0,0"/>
                <ComboBox x:Name="PatientCombo"
                          DisplayMemberPath="FullName"
                          SelectedValuePath="Id"
                          Height="26"/>

                <Label Content="Date" Margin="0,8,0,0"/>
                <DatePicker x:Name="DatePicker"/>

                <Label Content="Heure (HH:mm)" Margin="0,8,0,0"/>
                <TextBox x:Name="TxtTime"
                         Height="26"
                         Text="09:00"
                         PreviewTextInput="TxtTime_PreviewTextInput"/>

                <Label Content="Durée (min)" Margin="0,8,0,0"/>
                <ComboBox x:Name="DurationCombo" Height="26">
                    <ComboBoxItem Content="15"/>
                    <ComboBoxItem Content="20"/>
                    <ComboBoxItem Content="30" IsSelected="True"/>
                    <ComboBoxItem Content="45"/>
                    <ComboBoxItem Content="60"/>
                </ComboBox>

                <Label Content="Notes (obligatoire)" Margin="0,8,0,0"/>
                <TextBox x:Name="TxtNotes"
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         VerticalScrollBarVisibility="Auto"
                         Height="140"/>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="10">
                    <Button Content="Ajouter" Width="100" Margin="5" Click="AddAppointment_Click"/>
                    <Button Content="Modifier" Width="100" Margin="5" Click="UpdateAppointment_Click"/>
                    <Button Content="Supprimer" Width="100" Margin="5" Click="DeleteAppointment_Click"/>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
